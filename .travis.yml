language: java
sudo: true
install: true
jdk:
  - openjdk14
services:
  - postgresql

before_script:
  - psql -c "CREATE USER mybudget_appl WITH PASSWORD 'mybudget_appl';"
  - psql -c "ALTER ROLE mybudget_appl SUPERUSER;"
  - psql -c "CREATE DATABASE mybudget;" -U mybudget_appl
  - psql -c "CREATE SCHEMA mybudget_appl;" -U mybudget_appl

env:
  global:
    - MYBUDGET_DB_URL=jdbc:postgresql://localhost:5432/mybudget
    - MYBUDGET_DB_USERNAME=mybudget_appl
    - MYBUDGET_DB_PASSWORD=mybudget_appl

jobs:
  include:
    - stage: build
      script:
        - mvn clean install

after_script:
  - psql -c "DROP DATABASE mybudget;" -U postgres